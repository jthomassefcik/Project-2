<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
        crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/style/style_login.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"></script>
</head>

<body style="background-color: #f5f5f5;">

    <div class="container-fluid" style="background-color: #f5f5f5;">

        <div class="row">
            <div class="col-xs-12 well" style="background-color:white;">

            </div>
        </div>


        <!-- controls the welcome text @ the -->
        <div class="row">
            <div class="col-xs-12">
                <h1 class="text-muted text-center">WELCOME</h1>
            </div>
        </div>

        <div class="row">

        </div>

        <form>
            <div class="well">
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12  table-responsive">
                            <table class="table table-striped custab" id="loanTable">
                                <thead>
                                    <tr>
                                        <th>Loan Name</th>
                                        <th>Loan Type</th>
                                        <th>Balance</th>
                                        <th>Interest Rate</th>
                                        <th>Minimum Payment</th>
                                        <th>Optimal Payment</th>
                                        <th class="text-center">Action</th>
                                    </tr>
                                </thead>
                                <tr>
                                    <td>1</td>
                                    <td>News</td>
                                    <td>News Cate</td>
                                    <td>News Cate</td>
                                    <td>News Cate</td>
                                    <td>News Cate</td>
                                    <td class="text-center"><a class='btn btn-info btn-xs' href="#"><span class="glyphicon glyphicon-edit"></span> Edit</a>
                                        <a href="#" data-id="name" class="deletebtn btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span> Del</a></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-2">
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">Add New Loan</button>
                        </div>
                        <div class="col-xs-12 col-sm-10 cal">
                            <form>
                                <div class="row">
                                    <div class="col-xs-6">
                                        <button class="btn btn-primary pull-right">Calculate</button>
                                    </div>
                                    <div class="col-xs-6">
                                        <input class="form-control" placeholder="How much can you pay?">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>


                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="exampleModalLabel">Add a new loan</h5>
                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                </div>
                                <div class="modal-body">
                                    <form>
                                        <div class="form-group">
                                            <label for="name">Name</label>
                                            <input name="name" type="text" class="form-control" id="name" aria-describedby="emailHelp" placeholder="Give a nickname to your loan.">

                                        </div>
                                        <div class="form-group">
                                            <label for="loan_type">Loan Type</label>
                                            <select name="loan_type" class="form-control" id="loan_type">
                                                    <option>Card</option>
                                                    <option>Mortgage</option>
                                                    <option>Gambling Debt</option>
                                                    <option>Car Payment</option>
                                                    <option>School Loan</option>
                                                </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="balance">balance</label>
                                            <input name="balance" type="number" class="form-control" id="balance" placeholder="$ 0.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="interest_rate">Interest</label>
                                            <input name="interest_rate" type="number" class="form-control" id="name" aria-describedby="emailHelp" placeholder="$ 0.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="minimum_Payment">Minimum Payment</label>
                                            <input name="minimum_Payment" type="text" class="form-control" id="minimum_Payment" aria-describedby="emailHelp" placeholder="$ 0.00">
                                        </div>

                                    </form>
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                                    <button id="newLoan" type="button" class="btn btn-primary">Add +</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </form>
    </div>

</body>

<script type="text/javascript">
    var currentURL = window.location.origin;
    $("#newLoan").on("click", function () {
        var newLoan = {
            name: $("#name").val().trim().toLowercase(),
            loan_type: $("#loan_type").val(),
            balance: $("#balance").val(),
            interest: $("#interest_rate").val(),
            minimum_Payment: $("#minimum_Payment")
        };

        var currentURL = window.location.origin;
        $.post(currentURL + '/createAccount', newLoan, function (res) {
            console.log(res);
            updateTable(res);
        })

        console.log(newLoan);
    });

    $(".deletebtn").on("click", function () {
        console.log("deletebtn working")
        var id = $(this).data("id");
        console.log(id);

        $.post(currentURL + 'api/delete', id, function (res) {

            updateTable(res);
        })
    })

</script>

<!--Script for handlebars template-->

<script>
    var loanTemplate;

    $(document).ready(function () {
        var source = $("#loan-template").html();
        loanTemplate = Handlebars.compile(source);

        getinitialData();


    })

    function getinitialData() {
        $.get(currentURL + 'api/getUser', function (res) {
            updateTable(res);

        })
    }

    function updateTable(res) {
        var userloanInfo = res;
        for (var i = 0; i < userloanInfo.length; i++) {
            var newRow = {
                name: userloanInfo[i].name,
                loan_type: userloanInfo.loan_type,
                balance: userloanInfo.balance,
                interest: userloanInfo.interest,
                minimum_Payment: userloanInfo.minimum_Payment,
                optimal_Payment: userloanInfo.optimal_Payment

            }
            var html = loanTemplate(newRow);

            $("#loanTable").html(html);

        }
    }

</script>

<script id="loan-template" type="text/x-handlebars-template">
    <tr>
        <td>{{name}}</td>
        <td>{{loan_type}}</td>
        <td>{{balance}}</td>
        <td>{{interest}}</td>
        <td>{{minimum_Payment}}</td>
        <td>{{optimal_Payment}}</td>
        <td class="text-center"><a data-id={{name}} class='deletebtn btn btn-info btn-xs' href="#"><span class="glyphicon glyphicon-edit"></span> Edit</a>            <a href="#" class="btn btn-danger btn-xs"><span class="glyphicon glyphicon-remove"></span> Del</a></td>
    </tr>

</script>

</html>